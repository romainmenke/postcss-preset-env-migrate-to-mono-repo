From 5069501ac26fca3186388d389c347708d0cb2ceb Mon Sep 17 00:00:00 2001
From: romainmenke <romainmenke@gmail.com>
Date: Thu, 4 Nov 2021 00:03:35 +0100
Subject: [PATCH 5/6] wip

---
 package.json                                  |  9 +++++----
 {cli => packages}/base-cli/.gitignore         |  0
 {cli => packages}/base-cli/CHANGELOG.md       |  0
 {cli => packages}/base-cli/CONTRIBUTING.md    |  0
 {cli => packages}/base-cli/INSTALL.md         |  0
 {cli => packages}/base-cli/LICENSE.md         |  0
 {cli => packages}/base-cli/README.md          |  0
 {cli => packages}/base-cli/package.json       |  1 -
 {cli => packages}/base-cli/src/args.ts        |  8 ++++----
 {cli => packages}/base-cli/src/index.ts       |  2 +-
 {cli => packages}/base-cli/stryker.conf.json  |  0
 {cli => packages}/base-cli/test/test.mjs      |  0
 {cli => packages}/base-cli/tsconfig.json      |  0
 .../convert-colors/.gitignore                 |  0
 .../convert-colors/.rollup.js                 |  0
 {plugins => packages}/convert-colors/.tape.js |  0
 .../convert-colors/CHANGELOG.md               |  0
 .../convert-colors/CONTRIBUTING.md            |  0
 .../convert-colors/LICENSE.md                 |  0
 .../convert-colors/README.md                  |  0
 .../convert-colors/package.json               |  0
 .../convert-colors/src/hex-rgb.js             |  0
 .../convert-colors/src/hsl-hsv.js             |  0
 .../convert-colors/src/hwb-hsv.js             |  0
 .../convert-colors/src/index.js               |  0
 .../convert-colors/src/keyword-rgb.js         |  0
 .../convert-colors/src/lab-ciede.js           |  0
 .../convert-colors/src/lab-lch.js             |  0
 .../convert-colors/src/lab-xyz.js             |  0
 .../convert-colors/src/rgb-contrast.js        |  0
 .../convert-colors/src/rgb-hsl.js             |  0
 .../convert-colors/src/rgb-hsv.js             |  0
 .../convert-colors/src/rgb-hwb.js             |  0
 .../convert-colors/src/rgb-xyz.js             |  0
 .../convert-colors/src/util.js                |  0
 plugins/postcss-nesting/stryker.conf.json     | 19 +++++++++++++++++++
 plugins/postcss-nesting/test/document.css     |  7 +++++++
 .../postcss-nesting/test/document.expect.css  |  8 ++++++++
 plugins/postcss-nesting/test/supports.css     | 11 +++++++++++
 .../postcss-nesting/test/supports.expect.css  | 13 +++++++++++++
 40 files changed, 68 insertions(+), 10 deletions(-)
 rename {cli => packages}/base-cli/.gitignore (100%)
 rename {cli => packages}/base-cli/CHANGELOG.md (100%)
 rename {cli => packages}/base-cli/CONTRIBUTING.md (100%)
 rename {cli => packages}/base-cli/INSTALL.md (100%)
 rename {cli => packages}/base-cli/LICENSE.md (100%)
 rename {cli => packages}/base-cli/README.md (100%)
 rename {cli => packages}/base-cli/package.json (92%)
 rename {cli => packages}/base-cli/src/args.ts (93%)
 rename {cli => packages}/base-cli/src/index.ts (99%)
 rename {cli => packages}/base-cli/stryker.conf.json (100%)
 rename {cli => packages}/base-cli/test/test.mjs (100%)
 rename {cli => packages}/base-cli/tsconfig.json (100%)
 rename {plugins => packages}/convert-colors/.gitignore (100%)
 rename {plugins => packages}/convert-colors/.rollup.js (100%)
 rename {plugins => packages}/convert-colors/.tape.js (100%)
 rename {plugins => packages}/convert-colors/CHANGELOG.md (100%)
 rename {plugins => packages}/convert-colors/CONTRIBUTING.md (100%)
 rename {plugins => packages}/convert-colors/LICENSE.md (100%)
 rename {plugins => packages}/convert-colors/README.md (100%)
 rename {plugins => packages}/convert-colors/package.json (100%)
 rename {plugins => packages}/convert-colors/src/hex-rgb.js (100%)
 rename {plugins => packages}/convert-colors/src/hsl-hsv.js (100%)
 rename {plugins => packages}/convert-colors/src/hwb-hsv.js (100%)
 rename {plugins => packages}/convert-colors/src/index.js (100%)
 rename {plugins => packages}/convert-colors/src/keyword-rgb.js (100%)
 rename {plugins => packages}/convert-colors/src/lab-ciede.js (100%)
 rename {plugins => packages}/convert-colors/src/lab-lch.js (100%)
 rename {plugins => packages}/convert-colors/src/lab-xyz.js (100%)
 rename {plugins => packages}/convert-colors/src/rgb-contrast.js (100%)
 rename {plugins => packages}/convert-colors/src/rgb-hsl.js (100%)
 rename {plugins => packages}/convert-colors/src/rgb-hsv.js (100%)
 rename {plugins => packages}/convert-colors/src/rgb-hwb.js (100%)
 rename {plugins => packages}/convert-colors/src/rgb-xyz.js (100%)
 rename {plugins => packages}/convert-colors/src/util.js (100%)
 create mode 100644 plugins/postcss-nesting/stryker.conf.json
 create mode 100644 plugins/postcss-nesting/test/document.css
 create mode 100644 plugins/postcss-nesting/test/document.expect.css
 create mode 100644 plugins/postcss-nesting/test/supports.css
 create mode 100644 plugins/postcss-nesting/test/supports.expect.css

diff --git a/package.json b/package.json
index 88369fe..576b9e9 100644
--- a/package.json
+++ b/package.json
@@ -6,8 +6,9 @@
   "author": "Jonathan Neal <jonathantneal@hotmail.com>",
   "license": "CC0-1.0",
   "workspaces": [
-    "cli/*",
-    "plugins/*"
+    "packages/*",
+    "plugins/*",
+    "cli/*"
   ],
   "devDependencies": {
     "@babel/core": "^7.15.8",
@@ -17,12 +18,12 @@
     "@rollup/plugin-node-resolve": "^13.0.6",
     "@rollup/plugin-typescript": "^8.3.0",
     "@stryker-mutator/core": "^5.4.1",
+    "@typescript-eslint/eslint-plugin": "^5.3.0",
     "eslint": "^8.1.0",
     "rollup": "^2.58.3",
     "rollup-plugin-terser": "^7.0.2",
     "tslib": "^2.3.1",
-    "typescript": "^4.4.4",
-    "@typescript-eslint/eslint-plugin": "^5.3.0"
+    "typescript": "^4.4.4"
   },
   "scripts": {
     "build": "npm run build --workspaces --if-present",
diff --git a/cli/base-cli/.gitignore b/packages/base-cli/.gitignore
similarity index 100%
rename from cli/base-cli/.gitignore
rename to packages/base-cli/.gitignore
diff --git a/cli/base-cli/CHANGELOG.md b/packages/base-cli/CHANGELOG.md
similarity index 100%
rename from cli/base-cli/CHANGELOG.md
rename to packages/base-cli/CHANGELOG.md
diff --git a/cli/base-cli/CONTRIBUTING.md b/packages/base-cli/CONTRIBUTING.md
similarity index 100%
rename from cli/base-cli/CONTRIBUTING.md
rename to packages/base-cli/CONTRIBUTING.md
diff --git a/cli/base-cli/INSTALL.md b/packages/base-cli/INSTALL.md
similarity index 100%
rename from cli/base-cli/INSTALL.md
rename to packages/base-cli/INSTALL.md
diff --git a/cli/base-cli/LICENSE.md b/packages/base-cli/LICENSE.md
similarity index 100%
rename from cli/base-cli/LICENSE.md
rename to packages/base-cli/LICENSE.md
diff --git a/cli/base-cli/README.md b/packages/base-cli/README.md
similarity index 100%
rename from cli/base-cli/README.md
rename to packages/base-cli/README.md
diff --git a/cli/base-cli/package.json b/packages/base-cli/package.json
similarity index 92%
rename from cli/base-cli/package.json
rename to packages/base-cli/package.json
index 9a4a2bc..6c8e83c 100644
--- a/cli/base-cli/package.json
+++ b/packages/base-cli/package.json
@@ -18,7 +18,6 @@
     "test": "npm run test:lint && npm run test:js",
     "test:lint": "eslint src/**/*.ts --quiet",
     "test:js": "node ./test/test.mjs",
-    "stryker": "stryker run --logLevel error",
     "build": "tsc"
   },
   "peerDependencies": {
diff --git a/cli/base-cli/src/args.ts b/packages/base-cli/src/args.ts
similarity index 93%
rename from cli/base-cli/src/args.ts
rename to packages/base-cli/src/args.ts
index b331265..1e60476 100644
--- a/cli/base-cli/src/args.ts
+++ b/packages/base-cli/src/args.ts
@@ -111,7 +111,7 @@ export function parseArguments(args: Array<string>, allowedPluginOpts: Array<str
 				}
 
 				// Stryker disable next-line all
-				console.warn(`unknown argument : ${arg}`);
+				console.warn(`[error] unknown argument : ${arg}\n`);
 				// Stryker disable next-line all
 				helpLogger();
 				return SignalValue.InvalidArguments;
@@ -129,7 +129,7 @@ export function parseArguments(args: Array<string>, allowedPluginOpts: Array<str
 
 	if (parsedArgs.inputs.length > 1 && parsedArgs.output) {
 		// Stryker disable next-line all
-		console.warn(`omit "--output" when processing multiple inputs`);
+		console.warn(`[error] omit "--output" when processing multiple inputs\n`);
 		// Stryker disable next-line all
 		helpLogger();
 		return SignalValue.InvalidArguments;
@@ -150,7 +150,7 @@ export function parseArguments(args: Array<string>, allowedPluginOpts: Array<str
 			parsedPluginOpts = JSON.parse(pluginOpts);
 		} catch (_) {
 			// Stryker disable next-line all
-			console.warn(`plugin options must be valid JSON`);
+			console.warn(`[error] plugin options must be valid JSON\n`);
 			// Stryker disable next-line all
 			helpLogger();
 			return SignalValue.InvalidArguments;
@@ -163,7 +163,7 @@ export function parseArguments(args: Array<string>, allowedPluginOpts: Array<str
 			parsedArgs.pluginOptions[key] = value;
 		} else {
 			// Stryker disable next-line all
-			console.warn(`unknown plugin option : ${key}`);
+			console.warn(`[error] unknown plugin option: ${key}\n`);
 			// Stryker disable next-line all
 			helpLogger();
 			return SignalValue.InvalidArguments;
diff --git a/cli/base-cli/src/index.ts b/packages/base-cli/src/index.ts
similarity index 99%
rename from cli/base-cli/src/index.ts
rename to packages/base-cli/src/index.ts
index 01cf2f3..87da673 100644
--- a/cli/base-cli/src/index.ts
+++ b/packages/base-cli/src/index.ts
@@ -41,7 +41,7 @@ export function helpTextLogger(name: string, description: string, exampleOptions
 	}
 
 	return () => {
-		console.log(allHelp.join('\n'));
+		console.warn(allHelp.join('\n'));
 	}
 }
 
diff --git a/cli/base-cli/stryker.conf.json b/packages/base-cli/stryker.conf.json
similarity index 100%
rename from cli/base-cli/stryker.conf.json
rename to packages/base-cli/stryker.conf.json
diff --git a/cli/base-cli/test/test.mjs b/packages/base-cli/test/test.mjs
similarity index 100%
rename from cli/base-cli/test/test.mjs
rename to packages/base-cli/test/test.mjs
diff --git a/cli/base-cli/tsconfig.json b/packages/base-cli/tsconfig.json
similarity index 100%
rename from cli/base-cli/tsconfig.json
rename to packages/base-cli/tsconfig.json
diff --git a/plugins/convert-colors/.gitignore b/packages/convert-colors/.gitignore
similarity index 100%
rename from plugins/convert-colors/.gitignore
rename to packages/convert-colors/.gitignore
diff --git a/plugins/convert-colors/.rollup.js b/packages/convert-colors/.rollup.js
similarity index 100%
rename from plugins/convert-colors/.rollup.js
rename to packages/convert-colors/.rollup.js
diff --git a/plugins/convert-colors/.tape.js b/packages/convert-colors/.tape.js
similarity index 100%
rename from plugins/convert-colors/.tape.js
rename to packages/convert-colors/.tape.js
diff --git a/plugins/convert-colors/CHANGELOG.md b/packages/convert-colors/CHANGELOG.md
similarity index 100%
rename from plugins/convert-colors/CHANGELOG.md
rename to packages/convert-colors/CHANGELOG.md
diff --git a/plugins/convert-colors/CONTRIBUTING.md b/packages/convert-colors/CONTRIBUTING.md
similarity index 100%
rename from plugins/convert-colors/CONTRIBUTING.md
rename to packages/convert-colors/CONTRIBUTING.md
diff --git a/plugins/convert-colors/LICENSE.md b/packages/convert-colors/LICENSE.md
similarity index 100%
rename from plugins/convert-colors/LICENSE.md
rename to packages/convert-colors/LICENSE.md
diff --git a/plugins/convert-colors/README.md b/packages/convert-colors/README.md
similarity index 100%
rename from plugins/convert-colors/README.md
rename to packages/convert-colors/README.md
diff --git a/plugins/convert-colors/package.json b/packages/convert-colors/package.json
similarity index 100%
rename from plugins/convert-colors/package.json
rename to packages/convert-colors/package.json
diff --git a/plugins/convert-colors/src/hex-rgb.js b/packages/convert-colors/src/hex-rgb.js
similarity index 100%
rename from plugins/convert-colors/src/hex-rgb.js
rename to packages/convert-colors/src/hex-rgb.js
diff --git a/plugins/convert-colors/src/hsl-hsv.js b/packages/convert-colors/src/hsl-hsv.js
similarity index 100%
rename from plugins/convert-colors/src/hsl-hsv.js
rename to packages/convert-colors/src/hsl-hsv.js
diff --git a/plugins/convert-colors/src/hwb-hsv.js b/packages/convert-colors/src/hwb-hsv.js
similarity index 100%
rename from plugins/convert-colors/src/hwb-hsv.js
rename to packages/convert-colors/src/hwb-hsv.js
diff --git a/plugins/convert-colors/src/index.js b/packages/convert-colors/src/index.js
similarity index 100%
rename from plugins/convert-colors/src/index.js
rename to packages/convert-colors/src/index.js
diff --git a/plugins/convert-colors/src/keyword-rgb.js b/packages/convert-colors/src/keyword-rgb.js
similarity index 100%
rename from plugins/convert-colors/src/keyword-rgb.js
rename to packages/convert-colors/src/keyword-rgb.js
diff --git a/plugins/convert-colors/src/lab-ciede.js b/packages/convert-colors/src/lab-ciede.js
similarity index 100%
rename from plugins/convert-colors/src/lab-ciede.js
rename to packages/convert-colors/src/lab-ciede.js
diff --git a/plugins/convert-colors/src/lab-lch.js b/packages/convert-colors/src/lab-lch.js
similarity index 100%
rename from plugins/convert-colors/src/lab-lch.js
rename to packages/convert-colors/src/lab-lch.js
diff --git a/plugins/convert-colors/src/lab-xyz.js b/packages/convert-colors/src/lab-xyz.js
similarity index 100%
rename from plugins/convert-colors/src/lab-xyz.js
rename to packages/convert-colors/src/lab-xyz.js
diff --git a/plugins/convert-colors/src/rgb-contrast.js b/packages/convert-colors/src/rgb-contrast.js
similarity index 100%
rename from plugins/convert-colors/src/rgb-contrast.js
rename to packages/convert-colors/src/rgb-contrast.js
diff --git a/plugins/convert-colors/src/rgb-hsl.js b/packages/convert-colors/src/rgb-hsl.js
similarity index 100%
rename from plugins/convert-colors/src/rgb-hsl.js
rename to packages/convert-colors/src/rgb-hsl.js
diff --git a/plugins/convert-colors/src/rgb-hsv.js b/packages/convert-colors/src/rgb-hsv.js
similarity index 100%
rename from plugins/convert-colors/src/rgb-hsv.js
rename to packages/convert-colors/src/rgb-hsv.js
diff --git a/plugins/convert-colors/src/rgb-hwb.js b/packages/convert-colors/src/rgb-hwb.js
similarity index 100%
rename from plugins/convert-colors/src/rgb-hwb.js
rename to packages/convert-colors/src/rgb-hwb.js
diff --git a/plugins/convert-colors/src/rgb-xyz.js b/packages/convert-colors/src/rgb-xyz.js
similarity index 100%
rename from plugins/convert-colors/src/rgb-xyz.js
rename to packages/convert-colors/src/rgb-xyz.js
diff --git a/plugins/convert-colors/src/util.js b/packages/convert-colors/src/util.js
similarity index 100%
rename from plugins/convert-colors/src/util.js
rename to packages/convert-colors/src/util.js
diff --git a/plugins/postcss-nesting/stryker.conf.json b/plugins/postcss-nesting/stryker.conf.json
new file mode 100644
index 0000000..b3a8438
--- /dev/null
+++ b/plugins/postcss-nesting/stryker.conf.json
@@ -0,0 +1,19 @@
+{
+  "$schema": "../../node_modules/@stryker-mutator/core/schema/stryker-schema.json",
+  "mutate": [
+    "src/lib/**/*.js"
+  ],
+  "testRunner": "command",
+  "coverageAnalysis": "perTest",
+  "tempDirName": "../../.stryker-tmp",
+  "commandRunner": {
+    "command": "npm run test:tape"
+  },
+  "buildCommand": "npm run build",
+  "thresholds": {
+    "high": 100,
+    "low": 100,
+    "break": 100
+  },
+  "inPlace": true
+}
diff --git a/plugins/postcss-nesting/test/document.css b/plugins/postcss-nesting/test/document.css
new file mode 100644
index 0000000..612c248
--- /dev/null
+++ b/plugins/postcss-nesting/test/document.css
@@ -0,0 +1,7 @@
+a {
+	order: 1;
+
+	@document url("https://www.example.com/") {
+		order: 2;
+	}
+}
diff --git a/plugins/postcss-nesting/test/document.expect.css b/plugins/postcss-nesting/test/document.expect.css
new file mode 100644
index 0000000..eca98ac
--- /dev/null
+++ b/plugins/postcss-nesting/test/document.expect.css
@@ -0,0 +1,8 @@
+a {
+	order: 1
+}
+@document url("https://www.example.com/") {
+	a {
+		order: 2
+}
+	}
diff --git a/plugins/postcss-nesting/test/supports.css b/plugins/postcss-nesting/test/supports.css
new file mode 100644
index 0000000..2600818
--- /dev/null
+++ b/plugins/postcss-nesting/test/supports.css
@@ -0,0 +1,11 @@
+a {
+	order: 1;
+
+	@supports (order: 2) {
+		order: 2;
+	}
+
+	@supports (background-image: url('fo and o.png')) {
+		order: 3;
+	}
+}
diff --git a/plugins/postcss-nesting/test/supports.expect.css b/plugins/postcss-nesting/test/supports.expect.css
new file mode 100644
index 0000000..d905de0
--- /dev/null
+++ b/plugins/postcss-nesting/test/supports.expect.css
@@ -0,0 +1,13 @@
+a {
+	order: 1
+}
+@supports (order: 2) {
+	a {
+		order: 2
+}
+	}
+@supports (background-image: url('fo and o.png')) {
+	a {
+		order: 3
+}
+	}
-- 
2.33.1

